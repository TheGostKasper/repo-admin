!function(){function e(e){document.getElementById("bar-chart");$("#bar-chart").empty(),d&&d.destroy(),d=new Chart(document.getElementById("bar-chart"),{type:"bar",data:{labels:["Pending","Accepted","Ready","Delivered"],datasets:[{label:"#Min ",backgroundColor:["rgba(255, 99, 132, 0.2)","rgba(54, 162, 235, 0.2)","rgba(255, 206, 86, 0.2)","rgba(255, 159, 64, 0.2)"],data:e}]},options:{legend:{display:!1},title:{display:!0,text:"Minutes taken"}}})}function t(){return parseInt($("#orderTextSearch").val())}function a(t){o.creationDate=t.creationDate,o.acceptedDateTime=t.acceptedDateTime,o.assignedToDriverDateTime=t.assignedToDriverDateTime,o.deliveredDateTime=t.deliveredDateTime;var a;a=""==o.acceptedDateTime?r(o.creationDate,(new Date).toString()):0,e([a,r(o.creationDate,o.acceptedDateTime),r(o.acceptedDateTime,o.assignedToDriverDateTime),r(o.assignedToDriverDateTime,o.deliveredDateTime)])}function i(t){var a;a=""==t.acceptedDateTime?r(t.creationDate,(new Date).toString()):0,e([a,r(t.creationDate,t.acceptedDateTime),r(t.acceptedDateTime,t.assignedToDriverDateTime),r(t.assignedToDriverDateTime,t.deliveredDateTime)])}function r(e,t){var a=(moment.utc(t).toDate().getTime()-moment.utc(e).toDate().getTime())/1e3,i=a%3600;return""!=t?""==e?0:Math.floor(i/60)+"."+Math.floor(i%60):0}var d,n=new OrderDetails,o={};$("#orderTextSearch").on("keyup",function(e){13==e.keyCode&&(""!=$(this).val()?n.getOrder("order/details/"+$(this).val(),{}).then(function(e){if(null!=e.data){var t=e.data.products;a(e.data);for(var i="",r=0;r<t.length;r++)i+="<tr><td>"+t[r].quantity+"x</td><td>"+t[r].nameEN+" "+t[r].size+t[r].unit+"</td><td> "+t[r].price*t[r].quantity+" </td></tr> ";i+='<tr><td colspan="2"></td><td>Total: '+e.data.grandTotal+" <br/>Tip: "+e.data.tip+".00 <br/>Discount: "+e.data.discount+" %<br/>Tax: "+e.data.tax+" %<br/>Service: "+e.data.serviceFees+" </td></tr>",$("#productsList").html(i),$(".products-search-Info").removeClass("hide"),$(".pg-notfound").addClass("hide"),$(".creationDate").html(moment.utc(e.data.creationDate).toDate().toLocaleDateString())}else $(".pg-notfound").removeClass("hide"),$(".products-search-Info").addClass("hide")},function(e){$(".pg-notfound").removeClass("hide"),$(".products-search-Info").addClass("hide")}):($(".pg-notfound").removeClass("hide"),$(".products-search-Info").addClass("hide")))});var c=new SignalREntry,s=c.getConnectionHub();s.client.updateOrderStatus=function(e,a){"Delivered"==e&&t()==a&&(o.deliveredDateTime=(new Date).toString(),i(o))},s.client.updateReadyOrder=function(e){"Ready"==e.state&&t(e.id)==e.id&&(o.assignedToDriverDateTime=(new Date).toString(),i(o))},s.client.updateAcceptOrder=function(e){"Accepted"==e.state&&parseInt(t(e.id))==e.id&&(o.acceptedDateTime=(new Date).toString(),i(o))},s.client.updateCancelOrder=function(e){t()}}();