function gtTopOrd(){mrch.getData("order/list/top","GET",{}).then(function(e){null!=e.data&&(e=JSON.parse(JSON.stringify(e)),addOrderToactivity(e.data.reverse()))},function(e){})}function drawChart(e){var t=getArrayOfOrderStatus(e);return drawChartToView(t),getPercentage(t)}function getArrayOfOrderStatus(e){return orderObj={pending:e.pending,accepted:e.accepted,ready:e.ready,canceled:e.canceled,delivered:e.delivered},[orderObj.pending,orderObj.accepted,orderObj.ready,orderObj.canceled,orderObj.delivered]}function getPercentage(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t}function applyOrderChanges(e,t){$("#pendingOrders").css("width",e.pending/t*100+"%"),$("#pendingOrdersNumber").html('Pending Order<b class="pull-right">'+e.pending+"</b>"),$("#acceptedOrders").css("width",e.accepted/t*100+"%"),$("#acceptedOrdersNumber").html('Accepted Order<b class="pull-right">'+e.accepted+"</b>"),$("#readyOrders").css("width",e.ready/t*100+"%"),$("#readyOrdersNumber").html('Ready Order<b class="pull-right">'+e.ready+"</b>"),$("#canceledOrders").css("width",e.canceled/t*100+"%"),$("#canceledOrdersNumber").html('Canceled Order<b class="pull-right">'+e.canceled+"</b>"),$("#deliveredOrders").css("width",e.delivered/t*100+"%"),$("#deliveredOrdersNumber").html('Delivered Order<b class="pull-right">'+e.delivered+"</b>")}function drawChartToView(e){document.getElementById("bar-chart");$("#bar-chart").empty(),myChart&&myChart.destroy(),myChart=new Chart(document.getElementById("bar-chart"),{type:"bar",data:{labels:["Pending","Accepted","Ready","Canceled","Delivered"],datasets:[{label:"# Order",backgroundColor:["rgba(255, 99, 132, 0.2)","rgba(54, 162, 235, 0.2)","rgba(255, 206, 86, 0.2)","rgba(75, 192, 192, 0.2)","rgba(153, 102, 255, 0.2)","rgba(255, 159, 64, 0.2)"],data:e}]},options:{legend:{display:!1},title:{display:!0,text:"Daily Order "}}})}function drawDeviceUsage(e){new Chart(document.getElementById("doughnut-chart"),{type:"doughnut",data:{labels:["IOS","Android"],datasets:[{label:"Users",backgroundColor:["#3498DB","#1ABB9C"],data:e}]},options:{title:{display:!0,text:"Devices"}}})}function drawLangDeviceUsage(e){new Chart(document.getElementById("lang-chart"),{type:"doughnut",data:{labels:["Arabic","English"],datasets:[{label:"Users",backgroundColor:["#3498DB","#1ABB9C"],data:e}]},options:{title:{display:!0,text:"Language Used"}}})}function addOrderToactivity(e){var t=e;glob_activity=[];for(var r=0;r<t.length;r++){var a=t[r];glob_activity.push(a),drawActivity(a)}}function addOrderStateToActivity(e){UpdateActivity(e)}function UpdateActivity(e){var t=$.grep(glob_activity,function(t){return t.id==e.id});if(null!=t){t[0].state=e.state;addOrderToactivity(glob_activity)}}function getActivity(e){return $.grep(glob_activity,function(t){return t.id==e})[0]}function drawActivity(e){var t=e.creationDate?new Date(e.creationDate).toLocaleTimeString():"--",r=e.grandTotal?e.grandTotal:"--",a="";"Pending"==e.state&&(a="label-warning"),"Accepted"==e.state&&(a="label-info"),"Ready"==e.state&&(a="label-success"),"Delivered"==e.state&&(a="label-success"),"Canceled"==e.state&&(a="label-danger");var d=' <li><div class = "block" ><div class = "block_content" ><h2 class = "title" ><a data-toggle = "modal" data-id= '+e.id+'style= "font-weight: 600;cursor: pointer; color: #3e95cd;" data-target = "#orderModal" > OR00 '+e.id+' < /a> <span class = "label right '+a+'" > '+e.state+' < /span> </h2> <div class = "byline" ><span style = "font-style:normal;" > '+t+' < /span><a class="x-a">'+r+" EG</a></div> </div> </div> </li>";$(".list-unstyled").prepend(d)}var mrch=new Merchant,oDetails=new OrderDetails,orderObj={pending:0,accepted:0,ready:0,canceled:0,delivered:0},total=0,totalOrder=0,totalusers=0,ios=0,android=0,arlang=0,enlang=0,glob_activity=[],myChart;mrch.getData("order/state/list","GET",{}).then(function(e){var t=e.data;setTimeout(function(){var e=drawChart(t);applyOrderChanges(orderObj,e),totalOrder=t.orders,totalusers=t.users,ios=t.ios,android=t.android,arlang=t.arLang,enlang=t.enLang,$("#totalUsers").html(totalusers),$("#totalMerchant").html(t.merchants),$("#totalOrders").html(totalOrder),$("#iosUsers").text(t.ios),$("#androidUsers").text(t.android),drawDeviceUsage([ios,android]),drawLangDeviceUsage([arlang,enlang])},500),gtTopOrd()},function(e){});var hub=new SignalREntry,notificationHub=hub.getConnectionHub();notificationHub.client.orderNotify=function(e){orderObj.pending++;var t=drawChart(orderObj);applyOrderChanges(orderObj,t),totalOrder++,$("#totalOrders").html(totalOrder),glob_activity.splice(0,1),glob_activity.push(e),drawActivity(e)},notificationHub.client.updateOrderStatus=function(e,t){var r={};if(r.id=t,"Delivered"==e){orderObj.delivered++,orderObj.accepted--;var a=drawChart(orderObj);applyOrderChanges(orderObj,a),r.state="Delivered"}else{orderObj.canceled++,orderObj.accepted--;var a=drawChart(orderObj);applyOrderChanges(orderObj,a),r.state="Canceled"}addOrderStateToActivity(r)},notificationHub.client.updateReadyOrder=function(e){orderObj.ready++,orderObj.accepted--;var t=drawChart(orderObj);applyOrderChanges(orderObj,t),addOrderStateToActivity(e)},notificationHub.client.updateAcceptOrder=function(e){orderObj.accepted++,orderObj.pending--;var t=drawChart(orderObj);applyOrderChanges(orderObj,t),addOrderStateToActivity(e)},notificationHub.client.updateCancelOrder=function(e){var t={};orderObj.canceled++,orderObj.accepted--;var r=drawChart(orderObj);applyOrderChanges(orderObj,r),t=getActivity(e),t.state="Canceled",addOrderStateToActivity(t)},notificationHub.client.userCreated=function(e){totalusers++,$("#totalUsers").html(totalusers)},hub.getHubStarted().done(function(){$(".x_title").on("click",function(){})}),$(document).on("click",".title a",function(e){e.preventDefault(),oDetails.getOrder("order/details/"+$(this).data("id"),{}).then(function(e){if(null!=e.data){for(var t=e.data.products,r="",a=0;a<t.length;a++)r+="<tr><td>"+t[a].quantity+"x</td><td>"+t[a].nameEN+" "+t[a].size+t[a].unit+"</td><td> "+t[a].price*t[a].quantity+"</td></tr>";r+='<tr><td colspan="2"></td><td>Total: '+e.data.grandTotal+" <br/>Tip: "+e.data.tip+".00 <br/>Discount: "+e.data.discount+" %<br/>Tax: "+e.data.tax+" %<br/>Service: "+e.data.serviceFees+" </td></tr>",$("#productsList").html(r),$(".products-search-Info").removeClass("hide"),$(".pg-notfound").addClass("hide")}else $(".pg-notfound").removeClass("hide"),$(".products-search-Info").addClass("hide")},function(e){$(".pg-notfound").removeClass("hide"),$(".products-search-Info").addClass("hide")}),$("#myModal").modal("show")});